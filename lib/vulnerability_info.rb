# frozen_string_literal: true

require 'http'
require 'yaml'
require_relative '../init.rb'
config = YAML.safe_load(File.read('config/secrets.yml'))

def vulner_api_path(key)
  url = 'https://api.sb.cyber00rn.org/api/vulnerability/search?q=broken&fields=tweet&X-API-KEY='
  url += key
end

def call_vulner_url(url)
  HTTP.get(url)
end

API_KEY = SMS::Api.config.SEC_API_KEY
# HAPPY requests
vulner_url = vulner_api_path(API_KEY)
vulner_response = call_vulner_url(vulner_url)
data = vulner_response.parse
cves = data['cves']
File.write('spec/fixtures/vulner_results.yml', cves.to_yaml)
